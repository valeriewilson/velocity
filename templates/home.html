{% extends 'base.html' %}
{% block content %}
    <div>
        <form action="/results" method="POST" id="route-form">
            <label for="start-address">Start address:</label>
            <select name="address-options" id="address-dropdown">
                {% if addresses %}
                    {% for address in addresses %}
                        <option class="address">{{ address[0] }}</option>
                    {% endfor %}
                {% else %}
                    <option value="blank-address-option"></option>
                {% endif %}
                <option value="create-new-address" id="new-address">+ new address</option>
            </select>
            <script src="https://code.jquery.com/jquery.js"></script>
            <script>    
                var dropdown = document.getElementById("address-dropdown");
                dropdown.onchange = function(){
                   if(dropdown.value=="create-new-address"){
                     $('#new-address-information').removeClass()
                   }
                }
            </script>

            <br>
            <label for="route-type">Route type:</label>
            <select name="route-type" id="route-type">
                <option value="unselected-value">Select a route type</option>
                <option value="loop">Loop</option>
                <option value="midpoint">To midpoint and back</option>
            </select>
            <div class="hidden" id="midpoint-field">
                <label for="midpoint-address">Midpoint address:</label>
                <input type="midpoint-address" id="midpoint-address" class="address" name="midpoint-address">
            </div>
            <div class="hidden" id="miles-field">
                <label for="total-miles">How many miles?</label>
                <input type="total-miles" id="total-miles" name="total-miles" required>
            </div>
            <br>
            <input type="submit" value="Let's ride!">
        </form>
    </div>

    <div id="new-address-information" class="hidden">
        <h3>New address information</h3>
        <form action="/new_address" method="POST" id="new-address-form">
            <label for="new-address-field">Address:</label>
            <input type="new-address-field" id="new-address-field" class="address" name="new-address-field">
            <br>
            <label for="label-field">Name:</label>
            <input type="label-field" id="label-field" name="label-field">
            <br>
            <label for="radio">Default address?</label>
            <input type="radio" name="default-address" value="true" id="default-address"> Yes<br>
            <br>
            <input type="submit" value="Save" id="save-button">
        </form>
    </div>
    <script>
        "use strict";

        var route_dropdown = document.getElementById("route-type");
        route_dropdown.onchange = function(){
            $('#midpoint-field').addClass("hidden")
            $('#miles-field').addClass("hidden")
            if(route_dropdown.value=="loop"){
                $('#miles-field').removeClass()
            }
            else if(route_dropdown.value=="midpoint"){
                $('#midpoint-field').removeClass()
            }
        }

        function updateAddressDropdown(result) {
            $("#new-address-information").addClass("hidden");
            $('#address-dropdown').empty();
            var addresses = result.addresses;
            
            for (var step = 0; step < addresses.length; step++) {
                $('#address-dropdown').append($('<option></option>').html(addresses[step][0]));
            }
            $('#address-dropdown').append('<option value="create-new-address">+ new address</option>');
        }

        function addAddress(evt) {
            evt.preventDefault();

            var formInputs = {
                "new-address-field": $("#new-address-field").val(),
                "label-field": $("#label-field").val(),
                "default-address": $('#default-address').is(':checked')
            };
            $.post("/new_address", formInputs, updateAddressDropdown);
        }

        $('#new-address-form').on("submit", addAddress);

    </script>

{% endblock %}